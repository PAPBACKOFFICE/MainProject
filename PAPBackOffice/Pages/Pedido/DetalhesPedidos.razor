@page "/Pedidos/Detalhes/{Id:int}"

@attribute [Authorize]

<h3>Pedidos</h3>
@if (Pedido != null)
{
    <h4>@Pedido.Assunto</h4>
}
<Row>
    <Column ColumnSize="ColumnSize.Is3">
        <div class="card">
            <div class="card-body">
                @if (Pedido != null)
                {
                    <PedidosForm @bind-Pedido="Pedido" IsCreating="false"></PedidosForm>
                }
            </div>
        </div>
    </Column>
    <Column ColumnSize="ColumnSize.Is9">
        <Tabs SelectedTab="@selectedTab" SelectedTabChanged="@OnSelectedTabChanged">
            <Items>
                @*<Tab Name="pedidos">Colaboradores</Tab>*@
                <Tab Name="actividade">Actividade</Tab>
            </Items>
            <Content>
                @*<TabPanel Name="pedidos">
                        <div class="card">
                            <div class="card-body">
                                @if (Pedidos != null)
                                {
                                    <Table>
                                        <TableHeader>
                                            <TableRow>
                                                <TableHeaderCell>#</TableHeaderCell>
                                                <TableHeaderCell>Nome</TableHeaderCell>
                                                <TableHeaderCell>Função</TableHeaderCell>
                                                <TableHeaderCell> Telefone</TableHeaderCell>
                                                <TableHeaderCell> Email</TableHeaderCell>
                                            </TableRow>
                                        </TableHeader>
                                        <TableBody>
                                            @foreach (var Pedido in Pedidos)
                                            {
                                            <TableRow>
                                                <TableRowHeader>@Colaborador.Id</TableRowHeader>
                                                <TableRowHeader>@Colaborador.Nome</TableRowHeader>
                                                <TableRowCell>@Colaborador.Funcao</TableRowCell>
                                                <TableRowCell>@Colaborador.Telefone</TableRowCell>
                                                <TableRowCell>@Colaborador.Email</TableRowCell>
                                            </TableRow>
                                            }
                                        </TableBody>
                                        @if (Pedidos == null || Pedidos.Count == 0)
                                        {
                                            <TableFooter>
                                                <TableRow Class="text-center">
                                                    <TableRowCell ColumnSpan="4">Não existem Colaborador para este pedido . Ainda...</TableRowCell>
                                                </TableRow>
                                            </TableFooter>
                                        }
                                    </Table>
                                }
                            </div>
                            <div class="card-footer">
                            </div>
                        </div>
                    </TabPanel>*@
                <TabPanel Name="actividade">
                    <div class="card">
                        <div class="card-body">

                        </div>
                        <div class="card-footer">

                        </div>
                    </div>
                </TabPanel>
            </Content>
        </Tabs>
    </Column>
</Row>

@code {

    [Inject]
    public IDbContextFactory<AppDatabaseContext> dbContextFactory { get; set; }

    [Parameter]
    public int Id { get; set; }

    [Inject]
    public IToastService ToastService { get; set; }

    protected Validations Validator;

    private Pedido Pedido = null;

    protected override async Task OnParametersSetAsync()
    {
        if (Id != 0)
        {
            using var context = dbContextFactory.CreateDbContext();

            Pedido = await context.Pedido
                .Include(m => m.Empresa)
                .Include(m => m.Colaborador)
                .FirstOrDefaultAsync(m => m.Id == Id);
        }
    }

    string selectedTab = "actividade";

    private void OnSelectedTabChanged(string name)
    {
        selectedTab = name;
    }
}
