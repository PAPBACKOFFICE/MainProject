@page "/Colaborador/Listar"
@inject NavigationManager navigationManager
@inject IRepository Repository
@using Microsoft.EntityFrameworkCore

@using Blazorise.DataGrid

@inject IToastService toastService


<ul class="breadcrumb">
    <li><a href="#">Home</a> <span class="divider">/</span></li>
    <li><a href="#">Colaborador</a> <span class="divider">/</span></li>
    <li class="active">Listar</li>
</ul>
<h1> I'M TRYING I SWEAR</h1>

<p> Give me a break for god sake </p>

<DataGrid TItem="Colaborador"
          Data="@colaboradores"
          ReadData="@OnReadData"
          TotalItems="@NumColaboradores"
          Sortable="true"
          Filterable="true"
          Editable="true"
          ShowPager="true"
          PageSize="15">
    <DataGridCommandColumn TItem="Colaborador">
        <NewCommandTemplate>
            <Button Color="Color.Success" @onclick="@(()=> CriarNovoColaborador = true)" Clicked="@context.Clicked">Novo</Button>
        </NewCommandTemplate>
        <EditCommandTemplate>
            <Tooltip Text="Editar">
                <Button Color="Color.Primary" Clicked="@context.Clicked"><i class="fa fa-edit"></i></Button>
            </Tooltip>
        </EditCommandTemplate>
        <DeleteCommandTemplate>
            <Tooltip Text="Eliminar">
                <Button Color="Color.Primary" @onclick="@(() => InativarColaborador(context.Item.Id))" Clicked="@context.Clicked"><i class="fa fa-trash-alt"></i></Button>
            </Tooltip>
        </DeleteCommandTemplate>
    </DataGridCommandColumn>
    <DataGridColumn TItem="Colaborador" Field="@nameof(Colaborador.Nome)" Caption="Nome" Editable="true"></DataGridColumn>
    <DataGridColumn TItem="Colaborador" Field="@nameof(Colaborador.Funcao)" Caption="Função" Editable="true"></DataGridColumn>
    <DataGridColumn TItem="Colaborador" Field="@nameof(Colaborador.Telefone)" Caption="Telefone" Editable="true"></DataGridColumn>
    <DataGridColumn TItem="Colaborador" Field="@nameof(Colaborador.Email)" Caption="Email" Editable="true"></DataGridColumn>
    <DataGridColumn TItem="Colaborador" Field="@nameof(Colaborador.Activo)" Caption="Activo" Editable="true">
        <DisplayTemplate>
            @if ((context as Colaborador)?.Activo == true)
            {
                <i class="fas fa-check-circle fa-2x text-success"></i>
            }
            else
            {
                <i class="fas fa-times-circle fa-2x text-danger"></i>
            }
        </DisplayTemplate>
    </DataGridColumn>
</DataGrid>

<AdicionarColaborador @bind-CriarNovaColaborador="CriarNovoColaborador"></AdicionarColaborador>

@code {

    [Inject]
    public IColaboradorServico ColaboradorServico { get; set; }

    private bool CriarNovoColaborador { get; set; }

    private List<Colaborador> colaboradores;
    private int NumColaboradores;

    async Task OnReadData(DataGridReadDataEventArgs<Colaborador> e)
    {
        // this can be call to anything, in this case we're calling a fictional api
        var response = await Repository.Query<Colaborador>()
                .Skip((e.Page - 1) * e.PageSize)
                .Take(e.PageSize)
                .ToListAsync();

        //($"some-api/employees?page={e.Page}&pageSize={e.PageSize}");

        colaboradores = response; // an actual data for the current page
        NumColaboradores = response.Count;
        // always call StateHasChanged!

        StateHasChanged();
    }

    protected void InativarColaborador(int Id)
    {
        ColaboradorServico.InativarColaborador(Id);
        toastService.ShowSuccess("Colaborador inativado com sucesso");
    }

}